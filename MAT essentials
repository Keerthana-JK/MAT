public class MedicationSchedulesRepo
{
    private MedicationScheduleGenerator _scheduleGenerator;

    public MedicationSchedulesRepo()
    {
        _scheduleGenerator = new MedicationScheduleGenerator();
    }

    // Accept the context from the caller to use the same DB context instance
    public void CreateMedicationSchedules(Medication medication, YourDbContext context)
    {
        // Generate the scheduled times from the medication's startDate, endDate, and frequency
        List<DateTime> scheduledTimes = _scheduleGenerator.GenerateScheduledTimes(medication.StartDate, medication.EndDate, medication.Frequency);

        foreach (var scheduledTime in scheduledTimes)
        {
            MedicationSchedule newSchedule = new MedicationSchedule
            {
                MedicationID = medication.MedicationID,
                ScheduledTime = scheduledTime,
                Status = "Pending", // Default status
                CreatedAt = DateTime.Now
            };

            // Save the new schedule to the same context
            context.MedicationSchedules.Add(newSchedule);
        }
    }
}
