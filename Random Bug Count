public static List<Dictionary<string, string>> ReadFile(string filepath, int sheetIndex = 0)
{
    var data = new List<Dictionary<string, string>>();
    string extension = Path.GetExtension(filepath).ToLower();

    try
    {
        if (extension == ".xlsx")
        {
            using (var workbook = new XLWorkbook(filepath))
            {
                var worksheet = workbook.Worksheet(sheetIndex);
                var headers = worksheet.Row(1).Cells().Select(cell => cell.GetValue<string>()).ToList();

                foreach (var row in worksheet.RowsUsed().Skip(1))
                {
                    var rowData = new Dictionary<string, string>();
                    for (int i = 0; i < headers.Count; i++)
                    {
                        rowData[headers[i]] = row.Cell(i + 1).GetValue<string>();
                    }
                    data.Add(rowData);
                }
            }
        }
        else if (extension == ".csv")
        {
            var lines = File.ReadAllLines(filepath);
            if (lines.Length > 0)
            {
                var headers = lines[0].Split(',').Select(h => h.Trim()).ToList();

                foreach (var line in lines.Skip(1))
                {
                    var values = line.Split(',');
                    var rowData = new Dictionary<string, string>();
                    for (int i = 0; i < headers.Count; i++)
                    {
                        rowData[headers[i]] = i < values.Length ? values[i].Trim() : string.Empty;
                    }
                    data.Add(rowData);
                }
            }
        }
        else
        {
            throw new NotSupportedException("Only .xlsx and .csv file formats are supported.");
        }
    }
    catch (Exception ex)
    {
        throw new Exception($"Error in ReadFile: {ex.Message}", ex);
    }

    return data;
}
