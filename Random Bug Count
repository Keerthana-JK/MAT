public static int GetRemainingRowCountWithStatusFilter(
    string filepath1, int sheetIndex1, string columnName1,
    string filepath2, int sheetIndex2, string columnName2, string statusColumnName, string statusValue)
{
    try
    {
        using (var workbook1 = new XLWorkbook(filepath1))
        using (var workbook2 = new XLWorkbook(filepath2))
        {
            // Load worksheets
            var worksheet1 = workbook1.Worksheet(sheetIndex1);
            var worksheet2 = workbook2.Worksheet(sheetIndex2);

            // Get IDs from the second file where the Status is "Fail"
            var idsToExclude = worksheet2
                .RowsUsed()
                .Skip(1) // Skip header
                .Where(row =>
                {
                    var statusCell = row.Cell(statusColumnName);
                    return statusCell != null && 
                           statusCell.GetValue<string>().Equals(statusValue, StringComparison.OrdinalIgnoreCase);
                })
                .Select(row => row.Cell(columnName2).GetValue<string>())
                .Where(id => !string.IsNullOrWhiteSpace(id)) // Exclude blanks
                .ToHashSet(StringComparer.OrdinalIgnoreCase);

            // Get IDs from the first file and exclude matches and blanks
            var remainingRowCount = worksheet1
                .Column(columnName1)
                .CellsUsed()
                .Skip(1) // Skip header
                .Count(cell => 
                    !string.IsNullOrWhiteSpace(cell.GetValue<string>()) && // Exclude blanks
                    !idsToExclude.Contains(cell.GetValue<string>())); // Exclude matches

            return remainingRowCount;
        }
    }
    catch (Exception ex)
    {
        throw new Exception($"Error in GetRemainingRowCountWithStatusFilter: {ex.Message}", ex);
    }
}
